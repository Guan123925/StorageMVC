
@{
    ViewBag.Title = "Detail";
    Layout = "~/Views/Master/Project/ProjectDetail.cshtml";
}
<script>
    $().ready(function () {
        ProjectDetail();
        StageDetail();
    })

     function ChangeDateFormat(val) {
        if (val != null) {
            var date = new Date(parseInt(val.replace("/Date(", "").replace(")/", ""), 10));
            //月份为0-11，所以+1，月份小于10时补个0
            var month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
            var currentDate = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
            return date.getFullYear() + "-" + month + "-" + currentDate;
        }
        return "";
    }
    function ProjectDetail() {
        var ProjectId = $("#hidProjectId").val();
        
        $.ajax({
            url: "/Project/ProjectDetail",
            data: {
                ProjectId: ProjectId
            },
            type: "POST",
            datatype: "JSON",
            success: function (res) {
                $(res.Project).each(function () {
                    $("#SpanNumber").text(res.Project[0].ProjectNumber);
                    $("#SpanDetail").text(res.Project[0].ProjectDescribe);
                    $("#SpanProjectPerson").text(res.Project[0].ProjectStaffId);
                    $("#SpanTechnologyPerson").text(res.Project[0].TechStaffId);
                    $("#SpanProductPerson").text(res.Project[0].ProductStaffId);
                    $("#SpanTestPerson").text(res.Project[0].TestStaffId);
                    $("#SpanBazaarPerson").text(res.Project[0].MarketStaffId);
                    $("#SpanStartTime").text(ChangeDateFormat(res.Project[0].ProjectStartTime));
                    $("#SpanOffTime").text(ChangeDateFormat(res.Project[0].ProjectOutTime));
                })
            }
        })
    }

    function StageDetail() {
        //var ProjectStageId = 1;

         var ProjectId = $("#hidProjectId").val();
            

        $.ajax({
            url: "/Project/StageDetail",
            data: {
                ProjectStageId:ProjectId
            },
            datatype: "Json",
            type:"Post",
            success: function (res) {
                var list = "";
                $(res.Stage).each(function () {
                    list += "<tr>" +
                        "<td>" + this.PlanId + "</td>" +
                        "<td>" + this.StageName + "</td>" +
                        "<td>" +ChangeDateFormat(this.StageStartTime) + "</td>" +
                        "<td>" + ChangeDateFormat(this.StageFinishTime) + "</td>" +
                        "<td>" + this.StageStaffName + "</td>" +
                        "</tr>";
                })
                $("#tdy").append(list);
            }
        })
    }
</script>