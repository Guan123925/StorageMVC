
@{
    ViewBag.Title = "AddProjectAndStage";
    Layout = "~/Views/Master/Project/ProjectAddOrUpdate.cshtml";
}

<script>
     $().ready(function () {
         StageDetail();
         ProjectBand();
         MarkBand();
         TestBand();
         TechBand();
         ProductBand();
     })

      function StageDetail() {
        var ProjectStageId = 1;

        $.ajax({
            url: "/Project/StageDetail",
            data: {
                ProjectStageId:ProjectStageId
            },
            datatype: "Json",
            type:"Post",
            success: function (res) {
                var list = "";
                $(res.Stage).each(function () {
                    list += "<tr>" +
                        "<td>" + this.PlanId + "</td>" +
                        "<td>" + this.StageName + "</td>" +
                        "<td>" + this.StageStartTime + "</td>" +
                        "<td>" + this.StageFinishTime + "</td>" +
                        "<td>" + this.StageStaffName + "</td>" +
                        "<td><a onclick='StageDelete("+this.PlanId+")' >删除</a>"+"</td>"+
                        "<td><a onclick='StageUpdtae("+this.PlanId+")' >修改</a>"+"</td>"+
                        "</tr>";  
                })
                $("#tby").append(list);

              
            }
        })
    }

      function StageDelete(PlanId) {
          if (confirm("确定要删除么？")) {
              $.ajax({
                  url:"/Project/DeleteStage",
                  data: {
                      PlanId: PlanId
                  },
                  type: "post",
                  datatype: "json",
                  success: function (res) {
                      if (res.IsRegistSuccess) {
                          alert("删除成功");
                      }
                      else {
                          alert("删除失败");
                      }
                  }
                 })
                }
    }

    function StageUpdtae(PlanId) {
        window.location = "/Project/StageUpdate?PlanId=" + PlanId;
    }

    function AddStage() {
        window.location = "/Project/StageAdd";
    }

    function ProjectBand() {
        var DepartId = 1;

        $.ajax({
            url: "/Project/BandProjectbinding",
            data: {
                DepartId: DepartId
            },
            type: "post",
            datatype: "json",
            success: function (res) {
                var list = "";
                $(res.info).each(function () {
                    list += "<option value='" + this.Id + "' >" + this.PositName + "</option>";
                })
                $("#selProject").append(list);
            }
        })
    }

    function TechBand() {
        var DepartId = 2;

        $.ajax({
            url: "/Project/BandProjectbinding",
            data: {
                DepartId: DepartId
            },
            type: "post",
            datatype: "json",
            success: function (res) {
                var list = "";
                $(res.info).each(function () {
                    list += "<option value='" + this.Id + "' >" + this.PositName + "</option>";
                })
                $("#selTech").append(list);
            }
        })
    }

    function ProductBand() {
        var DepartId = 3;

        $.ajax({
            url: "/Project/BandProjectbinding",
            data: {
                DepartId: DepartId
            },
            type: "post",
            datatype: "json",
            success: function (res) {
                var list = "";
                $(res.info).each(function () {
                    list += "<option value='" + this.Id + "' >" + this.PositName + "</option>";
                })
                $("#selProduct").append(list);
            }
        })
    }

    function TestBand() {
        var DepartId = 4;

        $.ajax({
            url: "/Project/BandProjectbinding",
            data: {
                DepartId: DepartId
            },
            type: "post",
            datatype: "json",
            success: function (res) {
                var list = "";
                $(res.info).each(function () {
                    list += "<option value='" + this.Id + "' >" + this.PositName + "</option>";
                })
                $("#selTest").append(list);
            }
        })
    }

    function MarkBand() {
        var DepartId = 5;

        $.ajax({
            url: "/Project/BandProjectbinding",
            data: {
                DepartId: DepartId
            },
            type: "post",
            datatype: "json",
            success: function (res) {
                var list = "";
                $(res.info).each(function () {
                    list += "<option value='" + this.Id + "' >" + this.PositName + "</option>";
                })
                $("#selMark").append(list);
            }
        })
    }

    function AddProject() {
        var ProjectNumber = $("#txtNumber").val();
        var ProjectName = $("#txtName").val();
        var ProjectDescribe = $("#txtDetail").val();
        var ProjectStaffId = $("#selProject").val();
        var TechStaffId = $("#selTech").val();
        var ProductStaffId = $("#selProduct").val();
        var TestStaffId = $("#selTest").val();
        var MarketStaffId = $("#selMark").val();
        var ProjectStartTime = $("#txtStartTime").val();
        var ProjectOutTime = $("#txtOffTime").val();
        var ProjectStage = 0;


        $.ajax({
            url: "/Project/AddProject",
            data: {
                ProjectNumber: ProjectNumber,
                ProjectName: ProjectName,
                ProjectDescribe: ProjectDescribe,
                ProjectStaffId: ProjectStaffId,
                TechStaffId: TechStaffId,
                ProductStaffId: ProductStaffId,
                TestStaffId: TestStaffId,
                MarketStaffId: MarketStaffId,
                ProjectStartTime: ProjectStartTime,
                ProjectOutTime: ProjectOutTime,
                ProjectStage:ProjectStage
            },
            datatype: "json",
            type: "post",
            success: function (res) {
                if (res.IsRegistSuccess) {
                    alert("添加成功");
                }
                else {
                    alert("添加失败");
                }
            }
        })
    }
</script>
